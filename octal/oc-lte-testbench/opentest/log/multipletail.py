import os, sys
import subprocess
import Tkinter, tkFileDialog


def start_tail_logs_program(folder, config_path=None, file_ends_with = ['.log']):
    path_script = os.path.dirname(os.path.realpath(__file__))

    if not config_path:
        config_path = os.path.join(path_script, 'default_logexpert.dat')
    command_args = []
    for root, dirs, files in os.walk(folder, topdown=False):
        for f in files:
            path = os.path.abspath(os.path.join(root, f))
            for ending in file_ends_with:
                if f.endswith(ending):
                    command_args = command_args + [path]
                    break

    path_exe = os.path.join(path_script, r'LogExpert\LogExpert.exe')
    #command_args = recursive_folder_search(folder)

    p = subprocess.Popen([path_exe] + ['-config', config_path] + command_args)
    return p

def ask_directory():
    root = Tkinter.Tk()
    root.withdraw()
    dirname = tkFileDialog.askdirectory(parent=root,initialdir=".",title='Please select a directory')

    if bool(dirname):
        start_tail_logs_program(dirname)

def main():
    if len(sys.argv) > 1:
        start_tail_logs_program(sys.argv[1])
    else:
        ask_directory()
